<!DOCTYPE html>
<html lang="en">
<head>
	<div id="main-head">
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>{{ title }}</title>
		<link rel='stylesheet' href='/stylesheets/style.css' />

		<!-- JQuery Bower -->
		<script type="text/javascript" src='/bower_components/jquery/dist/jquery.min.js'></script>

		<!-- Tether Bower (required for bootstrap 4.0.0) -->
		<link rel="stylesheet" href="/bower_components/tether/dist/css/tether.min.css">
		<script type="text/javascript" src="bower_components/tether/dist/js/tether.min.js"></script>

		<!-- Bootstrap Bower 4.0.0 -->
		<link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
		<script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	</div>
</head>

<body>
	<div id="navbar">
		<div id="outerdiv" class="visible-lg" style="margin-top: 5px;">
			<input type="text" data-i-search-input="true" class="form-control" name="word" data-autocomplete="true" data-autocomplete-url="" placeholder="Search" id="search_bar"></input>
		</div>
		<br>

		<div id="tabs">
			<ul class="nav nav-tabs" id="tab_list">
				<li class="nav-item" id="photo_tab">
					<a class="nav-link active" id="photo_link" href="#">Photo</a>
				</li>
				<li class="nav-item" id="video_tab">
					<a class="nav-link" id="video_link" href="#">Video</a>
				</li>
			</ul>
		</div>
	</div>

	<br>
	<div id="resultdiv">
{{! 		<div id="padding"><a class="result"><img src="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcSayd3B71SXS8b9GvuQiyu88aDbEmyGWpAGEOjNF4VFIT0uhs5R"></a></div>
		<div id="padding"><a class="result"><img src="http://www.famousphotographers.net/images/mario-testino.jpg"></a></div>
		<div id="padding"><a class="result"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSWF_r3SzX9hdgKIGo9RH3wUNKSRcATwTjNle80Eg0rw-yuuPncgOuCg0Za"></a></div> }}
		<div id="innerdiv"></div>
	</div>
</body>

<script>
var searchRequest = null;

$(function () {
    var minlength = 0;

    $('.result').click(function (e){
    	var active_id = current_ID();
    	if (active_id == "photo_link") {
    		window.location.href = "filter";
    	} else { // active_id == "video_link"
    		window.location.href = "select_frame";
    	}
    })

    $("#search_bar").keyup(function () {
        var that = this,
        value = encodeURIComponent($(this).val());

        var active_id = current_ID();

        if (value.length >= minlength ) {
            if (searchRequest != null) 
                searchRequest.abort();
            if (active_id == 'photo_link') {
            	console.log("photo ajax");
            	searchRequest = $.ajax({
            		type: "GET",
            		contentType: 'text/plain',
					crossDomain: true,
            		url: "http://ec2-54-67-117-88.us-west-1.compute.amazonaws.com/search/allimages/text/", // PHOTO SEARCH
            		data: {
            			'query' : value
            		},
            		dataType: 'text',
            		success: function(msg){
            			var json_obj = JSON.parse(msg);
            			var result = $("#resultdiv");
            			var innerdiv = $("<div>");
            			$.each(json_obj.images, function(index, element) {
        					innerdiv.append("<div id=\"padding\"><a><img class=\"result\" src=\"" + element.image_url + "\"></a></div>");
        					// result.html(innerdiv);
            			}); 
            			result.html(innerdiv);
            		}
            	});

            } else { // active_id == 'video_link'
	            console.log("video ajax");
            	searchRequest = $.ajax({
            		type: "GET",
            		contentType: 'text/plain',
					crossDomain: true,
            		url: "http://ec2-54-67-117-88.us-west-1.compute.amazonaws.com/search/allvideos/text/", // VIDEO SEARCH
            		data: {
            			'query' : value
            		},
            		dataType: "text",
            		success: function(msg){
            			var json_obj = JSON.parse(msg);
            			console.log(json_obj);
            			var result = $("#resultdiv");
            			var innerdiv = $("<div>");
            			$.each(json_obj.videos, function(index, element) {
            				var timediv = $("<div>");
        					$.each(element.clips, function(clip_index, clip_elem) {
        						console.log(clip_elem.start_time);
        						timediv.append("<li>" + clip_elem.start_time + "</li>");
        					}); 
        					innerdiv.append("<div id=\"1\"><video id=\"videoID\" controls><source src=\"" + element.video_url + "\" type=\"video/mp4\">Your browser does not support the video tag.</video><div id=\"2\"><center>" + timediv[0].innerHTML + "</center></div></div>");
            			}); 
            			result.html(innerdiv);
            		}
            	});
            }
        } 
    });

	$("body").on("click", ".result", function(){
		var original = this.src;
		// console.log(original);
		var parsed = original.split("/")[5];
		// console.log(name_pass);
		// window.location = 'filter';
		window.location = '/filter?image=' + encodeURIComponent(parsed);
	});

	$("body").on("click", "#time", function(){
		// var video_elem = this.parent.parent;
		// alert(video_elem);
		console.log(this);
		// video_elem.currentTime = this.innerText;
	});

	$("body").on("click", 'video #videoID', function(){
		console.log(this);
		var videoURL = this.source.src;
		console.log(videoURL);
	});

    $('#tab_list a').click(function (e) {
    	$(this).tab('show');
    	refresh_search(this.id);
    	// go to video tab or photo tab
    });
});

function current_ID() {
	var active_tab = $('#tab_list a.active');
	var active_id = active_tab.get(0).id;
	return active_id;
};

function populate_image_search(query){
	var newDiv = "<div class=\"result\">"
};

function populate_video_search(query){
	
};

function refresh_search(id){
	var query = $('#search_bar').val();
	if (id == 'photo_link') {
		console.log("photo tab clicked");
		populate_image_search(query);
	} else { // id == 'video_link'
		console.log("video tab clicked");
		populate_video_search(query);
	}
};
</script>

</html>