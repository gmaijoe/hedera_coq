<!DOCTYPE html>
<html lang="en">
<head>
	<div id="main-head">
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>{{ title }}</title>
        <link rel="icon" type="image/x-icon" href="images/favicon.ico"/>

		<link rel='stylesheet' href='/stylesheets/style.css' />

		<!-- JQuery Bower -->
		<script type="text/javascript" src='/bower_components/jquery/dist/jquery.min.js'></script>

		<!-- Tether Bower (required for bootstrap 4.0.0) -->
		<link rel="stylesheet" href="/bower_components/tether/dist/css/tether.min.css">
		<script type="text/javascript" src="bower_components/tether/dist/js/tether.min.js"></script>

		<!-- Bootstrap Bower 4.0.0 -->
		<link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
		<script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	</div>
</head>

<body>
    <a target="_blank" href="https://acusense.ai/"><img id="relative_logo" src="images/acusense-logo.png"></a>
    <center><h1>Apply a Filter!</h1></center><br><hr>
    <div id="content">
        <div class='col-xs-3 col-md-2'>
            <center>
                <b>Filters</b><br><br>
                <div id="filter_options">
                    <div class="form-check">
                        <label class="form-check-label">
                            <input class="form-check-input" type="radio" name="radAnswer" id="picasso" value="option1" checked>
                            Picasso
                        </label>
                        <img id="small" src="images/picasso.jpg">
                        <br>
                    </div>
                    <div class="form-check">
                        <label class="form-check-label">
                            <input class="form-check-input" type="radio" name="radAnswer" id="shipwreck" value="option2">
                            Shipwreck
                        </label>
                        <img id="small" src="images/shipwreck.jpg">
                        <br>
                    </div>
                </div>
            </center>
        </div>
        <div class='col-xs-3 col-md-2'>
            <center>
                <b>&nbsp;</b><br><br>
                <div id="filter_options">
                    <div class="form-check">
                        <label class="form-check-label"> 
                            <input class="form-check-input" type="radio" name="radAnswer" id="scream" value="option2">
                            Scream
                        </label>
                        <img id="small" src="images/scream.jpg">
                        <br>
                    </div>
                    <div class="form-check">
                        <label class="form-check-label">
                            <input class="form-check-input" type="radio" name="radAnswer" id="starry_night" value="option2">
                            Starry Night
                        </label>
                        <img id="small" src="images/starry_night.jpg">
                    </div>
                </div>
            </center>
        </div>
        <div class='col-xs-12 col-md-8'>
            <center>
                <b>Current Picture</b><br><br><br>
                <div id="img_content"></div>
            </center>
            <div id="loading_gif"></div>
            <p>&nbsp;</p>
            <div class="wrapper">
                <form id="create_pic">
                    <button type="submit" class="btn btn-success">Create Picture</button>
                </form>
            </div>
            <br><br><br>
        </div>
    </div>
</body>

<script>
function load_gif() {
    var gif = "/images/loading_gif.gif";
    $('#loading_gif').html("<img id=\"mediumgif\" src=\"" + gif + "\"></img>")
}

function remove_load_gif() {
    $('#loading_gif').empty();
}

$(function(){
    var queryString = getQueryStringValue("image"); 
    var originalURL = returnURL(queryString);
    
    $('#img_content').append("<img src=\"" + originalURL + "\">")


    document.getElementById("create_pic").onsubmit=function() {
        $('#load').show();
        var name = queryString;

        var active_id;
        if (document.getElementById('picasso').checked) {
            active_id = "picasso";
        } else if (document.getElementById('shipwreck').checked) {
            active_id = "shipwreck";
        } else if (document.getElementById('scream').checked) {
            active_id = "scream";
        } else if (document.getElementById('starry_night').checked) {
            active_id = "starry_night";
        } else {
            // nothing
        } 

        load_gif();
        searchRequest = $.ajax({
            type: "GET",
            contentType: 'text/plain',
            crossDomain: true,
            url: "https://api-hackathon-testino.acusense.ai/filter/image",
            data: {
                'image_name' : name,
                'filter' : active_id
            },
            dataType: "text",
            success: function(msg){
                var json_obj = JSON.parse(msg);
                var original = json_obj.original_url;
                var weird = json_obj.filtered_url;
                remove_load_gif();
                window.location = '/share?url=' + encodeURIComponent(weird);
            }
        });
        return false;
    }
});

function returnURL(link) {
    return "https://s3-us-west-1.amazonaws.com/hackathon-pmv/images/" + link;
}

function parseUrl(link) {
    return link.split("/")[5];
}

function getQueryStringValue (key) {  
  return unescape(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + escape(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));  
}  

function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) == variable) {
            return decodeURIComponent(pair[1]);
        }
    }
    console.log('Query variable %s not found', variable);
};
</script>

</html>